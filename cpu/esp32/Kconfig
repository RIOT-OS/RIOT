# Copyright (c) 2020 HAW Hamburg
#
# This file is subject to the terms and conditions of the GNU Lesser
# General Public License v2.1. See the file LICENSE in the top level
# directory for more details.

config CPU_CORE_XTENSA_LX6
    bool
    select CPU_ARCH_XTENSA

config CPU_FAM_ESP32
    bool
    select CPU_COMMON_ESP
    select CPU_CORE_XTENSA_LX6
    select HAS_ARCH_ESP32
    select HAS_CPU_ESP32
    select HAS_ESP_WIFI_ENTERPRISE
    select HAS_PERIPH_ADC_CTRL
    select HAS_PERIPH_RTC
    select HAS_PERIPH_RTT
    select HAS_PERIPH_RTT_SET_COUNTER
    select HAS_PERIPH_RTT_OVERFLOW

    select MODULE_PERIPH_RTT if HAS_PERIPH_RTT && MODULE_PM_LAYERED
    select MODULE_RTT_RTC if HAS_PERIPH_RTT && MODULE_PERIPH_RTC
    select MODULE_PS if MODULE_SHELL
    select MODULE_ESP_IDF_DRIVER if TEST_KCONFIG
    select MODULE_ESP_IDF_ESP32 if TEST_KCONFIG
    select MODULE_ESP_IDF_SOC if TEST_KCONFIG
    imply MODULE_NEWLIB_NANO

## CPU Models
config CPU_MODEL_ESP32_WROOM_32
    bool
    select CPU_FAM_ESP32

config CPU_MODEL_ESP32_WROVER
    bool
    select CPU_FAM_ESP32
    select HAS_ESP_SPI_RAM

config CPU_MODEL_ESP32_WROVER_B
    bool
    select CPU_FAM_ESP32
    select HAS_ESP_SPI_RAM

config CPU_MODEL_ESP32_WROVER_E
    bool
    select CPU_FAM_ESP32
    select HAS_ESP_SPI_RAM

config CPU_MODEL_ESP32_D0WD
    bool
    select CPU_FAM_ESP32

## Definition of specific features
config HAS_ARCH_ESP32
    bool
    help
        Indicates that the current architecture is ESP32.

config HAS_CPU_ESP32
    bool
    help
        Indicates that the current CPU is 'esp32'.

config HAS_ESP_ETH
    bool
    help
        Indicates that an ESP Ethernet interface is present.

config HAS_ESP_RTC_TIMER_32K
    bool
    help
        Indicates that an external 32.768 kHz crystal is connected to the ESP32
        in the board.

config HAS_ESP_SPI_RAM
    bool
    help
        Indicates that an external RAM is connected via the FSPI interface in
        the board.

config HAS_PERIPH_ADC_CTRL
    bool
    help
        Indicates that an ESP32 ADC controller peripheral is present.

config HAS_ESP_SPI_RAM
    bool
    help
        Indicates that the a RAM is present on the SPI bus.

## Common CPU symbols
config CPU_CORE
    default "xtensa-lx6" if CPU_CORE_XTENSA_LX6

config CPU_FAM
    default "esp32" if CPU_FAM_ESP32

config CPU_MODEL
    default "esp32-wroom_32" if CPU_MODEL_ESP32_WROOM_32
    default "esp32-wrover" if CPU_MODEL_ESP32_WROVER
    default "esp32-wrover" if CPU_MODEL_ESP32_WROVER_B
    default "esp32-wrover" if CPU_MODEL_ESP32_WROVER_E
    default "esp32-d0wd" if CPU_MODEL_ESP32_D0WD

config CPU
    default "esp32" if CPU_FAM_ESP32

menu "ESP32 configurations"
    depends on TEST_KCONFIG
    depends on HAS_ARCH_ESP32

config MODULE_ESP_SPI_RAM
    bool "SPI RAM support"
    select MODULE_ESP_IDF_HEAP
    depends on HAS_ESP_SPI_RAM
    select MODULE_ESP_IDF_HEAP
    help
      Say y to use external SPI RAM connected through the FSPI interface.

config MODULE_ESP_JTAG
    bool "Enable JTAG debugging interface"
    depends on HAS_ESP_JTAG

endmenu

# ESP32 specific module dependencies
config MODULE_ESP_ETH
    bool
    depends on HAS_ARCH_ESP32
    select MODULE_ESP_IDF_ETH
    select MODULE_ESP_IDF_ETH_PHY
    select MODULE_NETDEV_ETH
    select MODULE_NETOPT
    select MODULE_ZTIMER_MSEC

config MODULE_ESP_WIFI_ANY
    bool
    depends on HAS_ARCH_ESP32
    select MODULE_ESP_IDF_HEAP
    select MODULE_ESP_IDF_NVS_FLASH
    select MODULE_ESP_IDF_WPA_SUPPLICANT_CRYPTO
    select MODULE_ESP_IDF_WPA_SUPPLICANT_PORT

config MODULE_ESP_WIFI_ENTERPRISE
    bool
    depends on HAS_ARCH_ESP32
    select MODULE_ESP_IDF_WPA_SUPPLICANT_WPA2_EAP_PEER
    select MODULE_ESP_IDF_WPA_SUPPLICANT_WPA2_TLS
    select MODULE_ESP_IDF_WPA_SUPPLICANT_WPA2_UTILS

rsource "periph/Kconfig"
rsource "vendor/esp-idf/Kconfig"
source "$(RIOTCPU)/esp_common/Kconfig"
