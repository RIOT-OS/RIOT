From 030fd3cd68a0be8522d2e97a8aec776e9036cddd Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jos=C3=A9=20Ignacio=20Alamos=20Aste?= <jialamos@uc.cl>
Date: Thu, 14 Jul 2016 17:13:10 +0200
Subject: [PATCH 1/2] Makefile changes

---
 Makefile                                  |  17 +++
 src/cli/Makefile                          |   3 +
 src/core/Makefile                         |   3 +
 src/core/coap/Makefile                    |   3 +
 src/core/common/Makefile                  |   3 +
 src/core/crypto/Makefile                  |   3 +
 src/core/mac/Makefile                     |   3 +
 src/core/net/Makefile                     |   3 +
 src/core/thread/Makefile                  |   3 +
 third_party/mbedtls/Makefile              |   3 +
 third_party/mbedtls/repo/library/Makefile | 169 +-----------------------------
 11 files changed, 46 insertions(+), 167 deletions(-)
 create mode 100644 Makefile
 create mode 100644 src/cli/Makefile
 create mode 100644 src/core/Makefile
 create mode 100644 src/core/coap/Makefile
 create mode 100644 src/core/common/Makefile
 create mode 100644 src/core/crypto/Makefile
 create mode 100644 src/core/mac/Makefile
 create mode 100644 src/core/net/Makefile
 create mode 100644 src/core/thread/Makefile
 create mode 100644 third_party/mbedtls/Makefile

diff --git a/Makefile b/Makefile
new file mode 100644
index 0000000..17a8c1c
--- /dev/null
+++ b/Makefile
@@ -0,0 +1,17 @@
+ifneq (,$(filter openthread_core,$(USEMODULE)))
+ DIRS += src/core
+ DIRS += src/core/common
+ DIRS += src/core/mac
+ DIRS += src/core/thread
+ DIRS += src/core/coap
+ DIRS += src/core/crypto
+ DIRS += src/core/net
+ DIRS += third_party/mbedtls
+ DIRS += third_party/mbedtls/repo/library
+endif
+
+ifneq (,$(filter openthread_core,$(USEMODULE)))
+ DIRS += src/cli
+endif
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/cli/Makefile b/src/cli/Makefile
new file mode 100644
index 0000000..82ab5e6
--- /dev/null
+++ b/src/cli/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_cli
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/Makefile b/src/core/Makefile
new file mode 100644
index 0000000..632ec67
--- /dev/null
+++ b/src/core/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/coap/Makefile b/src/core/coap/Makefile
new file mode 100644
index 0000000..e3d25b6
--- /dev/null
+++ b/src/core/coap/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_coap
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/common/Makefile b/src/core/common/Makefile
new file mode 100644
index 0000000..bdb227d
--- /dev/null
+++ b/src/core/common/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_common
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/crypto/Makefile b/src/core/crypto/Makefile
new file mode 100644
index 0000000..4eaff68
--- /dev/null
+++ b/src/core/crypto/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_crypto
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/mac/Makefile b/src/core/mac/Makefile
new file mode 100644
index 0000000..2e7b457
--- /dev/null
+++ b/src/core/mac/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_mac
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/net/Makefile b/src/core/net/Makefile
new file mode 100644
index 0000000..2001fb0
--- /dev/null
+++ b/src/core/net/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_net
+
+include $(RIOTBASE)/Makefile.base
diff --git a/src/core/thread/Makefile b/src/core/thread/Makefile
new file mode 100644
index 0000000..e02e648
--- /dev/null
+++ b/src/core/thread/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_core_thread
+
+include $(RIOTBASE)/Makefile.base
diff --git a/third_party/mbedtls/Makefile b/third_party/mbedtls/Makefile
new file mode 100644
index 0000000..30770e4
--- /dev/null
+++ b/third_party/mbedtls/Makefile
@@ -0,0 +1,3 @@
+MODULE := mbedtls
+
+include $(RIOTBASE)/Makefile.base
diff --git a/third_party/mbedtls/repo/library/Makefile b/third_party/mbedtls/repo/library/Makefile
index 00528b3..54f5734 100644
--- a/third_party/mbedtls/repo/library/Makefile
+++ b/third_party/mbedtls/repo/library/Makefile
@@ -1,168 +1,3 @@
+MODULE := mbedtls_lib
 
-# Also see "include/mbedtls/config.h"
-
-CFLAGS	?= -O2
-WARNING_CFLAGS ?=  -Wall -W -Wdeclaration-after-statement
-LDFLAGS ?=
-
-LOCAL_CFLAGS = $(WARNING_CFLAGS) -I../include -D_FILE_OFFSET_BITS=64
-LOCAL_LDFLAGS =
-
-ifdef DEBUG
-LOCAL_CFLAGS += -g3
-endif
-
-# MicroBlaze specific options:
-# CFLAGS += -mno-xl-soft-mul -mxl-barrel-shift
-
-# To compile on Plan9:
-# CFLAGS += -D_BSD_EXTENSION
-
-# if were running on Windows build for Windows
-ifdef WINDOWS
-WINDOWS_BUILD=1
-endif
-
-# To compile as a shared library:
-ifdef SHARED
-# all code is position-indep with mingw, avoid warning about useless flag
-ifndef WINDOWS_BUILD
-LOCAL_CFLAGS += -fPIC -fpic
-endif
-endif
-
-SOEXT_TLS=so.10
-SOEXT_X509=so.0
-SOEXT_CRYPTO=so.0
-
-DLEXT=so
-# OSX shared library extension:
-# DLEXT=dylib
-
-# Windows shared library extension:
-ifdef WINDOWS_BUILD
-DLEXT=dll
-endif
-
-OBJS_CRYPTO=	aes.o		aesni.o		arc4.o		\
-		asn1parse.o	asn1write.o	base64.o	\
-		bignum.o	blowfish.o	camellia.o	\
-		ccm.o		cipher.o	cipher_wrap.o	\
-		ctr_drbg.o	des.o		dhm.o		\
-		ecdh.o		ecdsa.o		ecjpake.o	\
-		ecp.o						\
-		ecp_curves.o	entropy.o	entropy_poll.o	\
-		error.o		gcm.o		havege.o	\
-		hmac_drbg.o	md.o		md2.o		\
-		md4.o		md5.o		md_wrap.o	\
-		memory_buffer_alloc.o		oid.o		\
-		padlock.o	pem.o		pk.o		\
-		pk_wrap.o	pkcs12.o	pkcs5.o		\
-		pkparse.o	pkwrite.o	platform.o	\
-		ripemd160.o	rsa.o		sha1.o		\
-		sha256.o	sha512.o	threading.o	\
-		timing.o	version.o			\
-		version_features.o		xtea.o
-
-OBJS_X509=	certs.o		pkcs11.o	x509.o		\
-		x509_create.o	x509_crl.o	x509_crt.o	\
-		x509_csr.o	x509write_crt.o	x509write_csr.o
-
-OBJS_TLS=	debug.o		net.o		ssl_cache.o	\
-		ssl_ciphersuites.o		ssl_cli.o	\
-		ssl_cookie.o	ssl_srv.o	ssl_ticket.o	\
-		ssl_tls.o
-
-.SILENT:
-
-.PHONY: all static shared clean
-
-ifndef SHARED
-all: static
-else
-all: shared static
-endif
-
-static: libmbedcrypto.a libmbedx509.a libmbedtls.a
-
-shared: libmbedcrypto.$(DLEXT) libmbedx509.$(DLEXT) libmbedtls.$(DLEXT)
-
-# tls
-libmbedtls.a: $(OBJS_TLS)
-	echo "  AR    $@"
-	$(AR) -rc $@ $(OBJS_TLS)
-	echo "  RL    $@"
-	$(AR) -s $@
-
-libmbedtls.$(SOEXT_TLS): $(OBJS_TLS) libmbedx509.so
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ -L. -lmbedcrypto -lmbedx509 $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_TLS)
-
-libmbedtls.so: libmbedtls.$(SOEXT_TLS)
-	echo "  LN    $@ -> $<"
-	ln -sf $< $@
-
-libmbedtls.dylib: $(OBJS_TLS)
-	echo "  LD    $@"
-	$(CC) -dynamiclib $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_TLS)
-
-libmbedtls.dll: $(OBJS_TLS) libmbedx509.dll
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ -Wl,--out-implib,$@.a -o $@ $(OBJS_TLS) -lws2_32 -lwinmm -lgdi32 -L. -lmbedcrypto -lmbedx509 -static-libgcc $(LOCAL_LDFLAGS) $(LDFLAGS)
-
-# x509
-libmbedx509.a: $(OBJS_X509)
-	echo "  AR    $@"
-	$(AR) -rc $@ $(OBJS_X509)
-	echo "  RL    $@"
-	$(AR) -s $@
-
-libmbedx509.$(SOEXT_X509): $(OBJS_X509) libmbedcrypto.so
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ -L. -lmbedcrypto $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_X509)
-
-libmbedx509.so: libmbedx509.$(SOEXT_X509)
-	echo "  LN    $@ -> $<"
-	ln -sf $< $@
-
-libmbedx509.dylib: $(OBJS_X509)
-	echo "  LD    $@"
-	$(CC) -dynamiclib $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_X509)
-
-libmbedx509.dll: $(OBJS_X509) libmbedcrypto.dll
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ -Wl,--out-implib,$@.a -o $@ $(OBJS_X509) -lws2_32 -lwinmm -lgdi32 -L. -lmbedcrypto -static-libgcc $(LOCAL_LDFLAGS) $(LDFLAGS)
-
-# crypto
-libmbedcrypto.a: $(OBJS_CRYPTO)
-	echo "  AR    $@"
-	$(AR) -rc $@ $(OBJS_CRYPTO)
-	echo "  RL    $@"
-	$(AR) -s $@
-
-libmbedcrypto.$(SOEXT_CRYPTO): $(OBJS_CRYPTO)
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_CRYPTO)
-
-libmbedcrypto.so: libmbedcrypto.$(SOEXT_CRYPTO)
-	echo "  LN    $@ -> $<"
-	ln -sf $< $@
-
-libmbedcrypto.dylib: $(OBJS_CRYPTO)
-	echo "  LD    $@"
-	$(CC) -dynamiclib $(LOCAL_LDFLAGS) $(LDFLAGS) -o $@ $(OBJS_CRYPTO)
-
-libmbedcrypto.dll: $(OBJS_CRYPTO)
-	echo "  LD    $@"
-	$(CC) -shared -Wl,-soname,$@ -Wl,--out-implib,$@.a -o $@ $(OBJS_CRYPTO) -lws2_32 -lwinmm -lgdi32 -static-libgcc $(LOCAL_LDFLAGS) $(LDFLAGS)
-
-.c.o:
-	echo "  CC    $<"
-	$(CC) $(LOCAL_CFLAGS) $(CFLAGS) -c $<
-
-clean:
-ifndef WINDOWS
-	rm -f *.o libmbed*
-else
-	del /Q /F *.o libmbed*
-endif
+include $(RIOTBASE)/Makefile.base
-- 
2.7.4 (Apple Git-66)


From f1ca06d439346c6a6658465a059bce1aa31e7905 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jos=C3=A9=20Ignacio=20Alamos=20Aste?= <jialamos@uc.cl>
Date: Tue, 26 Jul 2016 11:30:19 +0200
Subject: [PATCH 2/2] Added RIOT makefiles

---
 Makefile         | 5 +++++
 src/ncp/Makefile | 3 +++
 2 files changed, 8 insertions(+)
 create mode 100644 src/ncp/Makefile

diff --git a/Makefile b/Makefile
index 17a8c1c..61a1cde 100644
--- a/Makefile
+++ b/Makefile
@@ -14,4 +14,9 @@ ifneq (,$(filter openthread_core,$(USEMODULE)))
  DIRS += src/cli
 endif
 
+ifneq (,$(filter openthread_ncp,$(USEMODULE)))
+ DIRS += src/ncp
+endif
+
+
 include $(RIOTBASE)/Makefile.base
diff --git a/src/ncp/Makefile b/src/ncp/Makefile
new file mode 100644
index 0000000..0f8e655
--- /dev/null
+++ b/src/ncp/Makefile
@@ -0,0 +1,3 @@
+MODULE := openthread_ncp
+
+include $(RIOTBASE)/Makefile.base
-- 
2.7.4 (Apple Git-66)

