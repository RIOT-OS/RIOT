language: c

cache: apt

env:
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=static-tests
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=avr8
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=msp430
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=x86
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=arm7
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=cortex_m0
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=cortex_m3_1
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=cortex_m3_2
    - NPROC_MAX=8 BUILDTEST_MCU_GROUP=cortex_m4

before_install:
    - source ./dist/tools/pr_check/check_labels.sh
    - test -z "$TRAVIS_PULL_REQUEST" || test "$BUILDTEST_MCU_GROUP" = "static-tests" || check_gh_label "Ready for CI build" || exit 1
    - echo 'deb mirror://mirrors.ubuntu.com/mirrors.txt vivid           main restricted universe multiverse' | sudo tee    /etc/apt/sources.list.d/vivid.list > /dev/null
    - echo 'deb mirror://mirrors.ubuntu.com/mirrors.txt vivid-updates   main restricted universe multiverse' | sudo tee -a /etc/apt/sources.list.d/vivid.list > /dev/null
    - echo 'deb mirror://mirrors.ubuntu.com/mirrors.txt vivid-backports main restricted universe multiverse' | sudo tee -a /etc/apt/sources.list.d/vivid.list > /dev/null
    - echo 'deb mirror://mirrors.ubuntu.com/mirrors.txt vivid-security  main restricted universe multiverse' | sudo tee -a /etc/apt/sources.list.d/vivid.list > /dev/null
    - sudo apt-get update

install:
    - sudo rm /etc/dpkg/dpkg.cfg.d/multiarch
    - sudo apt-get install dpkg
    - sudo dpkg --configure -a
    - sudo dpkg --add-architecture i386
    - sudo apt-get install $(./dist/tools/travis-scripts/get-pkg-list.py)
    - git config --global user.email "travis@example.com"
    - git config --global user.name "Travis CI"

    - git remote add riot https://github.com/RIOT-OS/RIOT.git
    - git fetch riot master
    - git log -1 --pretty=format:%H riot/master

script:
    - ./dist/tools/travis-scripts/build_and_test.sh

notifications:
    email: false
