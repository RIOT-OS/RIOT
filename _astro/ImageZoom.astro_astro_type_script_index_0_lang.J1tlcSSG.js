const E="starlight-image-zoom-zoomable",p=globalThis.requestIdleCallback??(g=>setTimeout(g,1));customElements.define("starlight-image-zoom",class y extends HTMLElement{#t;#o=[];#i;#r=this.querySelector("template");#e={image:"starlight-image-zoom-image",opened:"starlight-image-zoom-opened",source:"starlight-image-zoom-source",transition:"starlight-image-zoom-transition"};#d="zoomTransform";static#m=!1;constructor(){super();const t=()=>{p(()=>{const e=[...document.querySelectorAll(E)];e.length!==0&&(this.#f(e),document.addEventListener("click",this.#a),window.addEventListener("resize",this.#c))})};globalThis.addEventListener("DOMContentLoaded",t,{once:!0}),document.addEventListener("astro:after-preparation",()=>{document.removeEventListener("click",this.#a),window.removeEventListener("resize",this.#c)},{once:!0}),y.#m||=document.addEventListener("astro:after-swap",t)===void 0}#f(t){for(const e of t){const n=e.querySelector(":scope > img, :scope > picture img, :scope > svg");n&&(this.#o.push(n),e.querySelector("button")?.addEventListener("click",i=>{i.stopPropagation(),this.#h(n)}))}}#a=({target:t})=>{if(t instanceof HTMLElement&&t.closest("figcaption"))return;if(this.#t){this.#n();return}if(!(t instanceof HTMLImageElement)&&!(t instanceof SVGElement))return;let e;if(this.#o.includes(t))e=t;else if(this.#s(t)){const n=t.closest("svg");n&&this.#o.includes(n)&&(e=n)}e&&this.#h(e)};#c=()=>{this.#n(!0)};#l=()=>{this.#n()};#p=t=>{t.preventDefault(),this.#n()};#h(t){if(!this.#r||this.#t)return;this.#i=document.activeElement;const e=document.createElement("div");e.append(this.#r.content.cloneNode(!0));const n=e.querySelector("dialog"),i=n?.querySelector("figure");if(!n||!i)return;const a={overflow:document.body.style.overflow,width:document.body.style.width},c=document.body.clientWidth;document.body.style.overflow="hidden",document.body.style.width=`${c}px`,document.querySelector("header")?.style.setProperty("padding-inline-end",`calc(var(--sl-nav-pad-x) + ${window.innerWidth-c}px)`);const s=this.#g(t);t.classList.add(this.#e.source),s.classList.add(this.#e.image),i.append(s),this.#y(t.getAttribute("alt")||this.#v(t),i),document.body.append(e),document.addEventListener("wheel",this.#l,{once:!0}),n.addEventListener("cancel",this.#p),n.showModal(),p(()=>{s.style.transform="",document.body.classList.add(this.#e.opened)}),this.#t={body:a,dialog:n,image:t,zoomedImage:s}}#n(t=!1){if(window.removeEventListener("wheel",this.#l),!this.#t)return;const{zoomedImage:e}=this.#t;e.style.transform=e.dataset[this.#d]??"",document.body.classList.add(this.#e.transition),document.body.classList.remove(this.#e.opened);const{matches:n}=globalThis.matchMedia("(prefers-reduced-motion: reduce)");t||n?this.#u():e.addEventListener("transitionend",this.#u,{once:!0})}#u=()=>{if(!this.#t)return;const{dialog:t,image:e}=this.#t;document.body.classList.remove(this.#e.transition),e.classList.remove(this.#e.source),t.parentElement?.remove(),document.body.style.overflow=this.#t.body.overflow,document.body.style.width=this.#t.body.width,document.querySelector("header")?.style.setProperty("padding-inline-end","var(--sl-nav-pad-x)"),this.#t=void 0,this.#i instanceof HTMLElement&&this.#i.focus()};#y(t,e){if(Object.hasOwn(this.dataset,"hideCaption")||(t=t?.trim()??"",t.length===0))return;const n=document.createElement("figcaption");n.ariaHidden="true",n.textContent=t,e.append(n)}#g(t){const e=t.getBoundingClientRect(),n=this.#s(t)||this.#w(t),i=n?window.innerWidth:t.naturalWidth,a=n?window.innerHeight:t.naturalHeight,c=Math.min(window.innerWidth,i),s=Math.min(window.innerHeight,a),u=Math.min(c/i,s/a),l=(n?window.innerWidth:t.naturalWidth)*u,h=(n?window.innerHeight:t.naturalHeight)*u,m=(window.innerHeight-h)/2,f=(window.innerWidth-l)/2,o=t.cloneNode(!0);o.removeAttribute("id"),o.style.position="absolute",o.style.width=`${l}px`,o.style.height=`${h}px`,o.style.top=`${m}px`,o.style.left=`${f}px`,o.style.transform="";let r=e.width/l,d=e.height/h;n&&(r>d?d=r:r=d);const w=(-f+(e.width-l)/2+e.left)/r,v=(-m+(e.height-h)/2+e.top)/d;return o.style.transform=`scale(${r}, ${d}) translate3d(${w}px, ${v}px, 0)`,o.dataset[this.#d]=o.style.transform,!n&&t.parentElement?.tagName==="PICTURE"&&t.currentSrc&&o instanceof HTMLImageElement&&(o.src=t.currentSrc),t.id&&(o.dataset.zoomId=t.id),o}#w(t){if(t.currentSrc.toLowerCase().endsWith(".svg"))return!0;try{const e=new URL(t.currentSrc);return e.pathname!=="/_image"?!1:e.searchParams.get("href")?.includes("origFormat=svg")}catch{return!1}}#s(t){return t instanceof SVGElement}#v(t){return this.#s(t)?t.querySelector("title")?.textContent?.trim()??null:null}});
